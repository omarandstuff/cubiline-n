using UnityEngine;

public class CubilineSinglePlayer : MonoBehaviour
{
	//////////////////////////////////////////////////////////////
	///////////////////////// COMPONENTS /////////////////////////
	//////////////////////////////////////////////////////////////
	public CubilineArenaController arenaController;
	public CubilinePlayerController player;
	public OrbitAndLook followCamera;
	public PauseMenuController pauseMenuBase;

	//////////////////////////////////////////////////////////////
	///////////////////////// PARAMETERS /////////////////////////
	//////////////////////////////////////////////////////////////

	public uint arenaSize = 5;

	//////////////////////////////////////////////////////////////
	////////////////////// CONTROL VARIABLES /////////////////////
	//////////////////////////////////////////////////////////////

	private PauseMenuController pauseMenu;


	////////////////////////////////////////////////////////////////////////////////////////////////
	//////////////////////////////////////// MONO BEHAVIOR /////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////

	void Start ()
	{
		Reset();
	}
	
	void FixedUpdate ()
	{
		if(pauseMenu != null)
		{
			if (pauseMenu.status != PauseMenuController.STATUS.NONE)
			{
				pauseMenu.status = PauseMenuController.STATUS.CONTINUE;
				Destroy(pauseMenu.gameObject, 0.5f);
				pauseMenu = null;
				return;
			}
		}
		else
		{
			if(Input.GetAxis("Cancel") != 0)
			{
				pauseMenu = Instantiate(pauseMenuBase);
				return;
			}
			player.Go();
			arenaController.ManageArena();

			if (player.status == CubilinePlayerController.STATUS.FINISH)
			{
				
			}
		}

	}

	////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////// SETUP ////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////

	public void Reset()
	{
		// Keep size odd
		if (arenaSize < 5)
			arenaSize = 5;
		if (arenaSize % 2 == 0)
			arenaSize += 1;

		arenaController.Reset(arenaSize);
		followCamera.transform.localPosition = new Vector3(0.0f, 0.0f, -arenaSize * 2.0f);

		player.Reset(arenaSize);
	}
}
